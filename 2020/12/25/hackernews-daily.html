
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Hacker News Daily - Byte Tank</title>
  <meta name="author" content="Pedro Lopes">

  
  <meta name="description" content="Lightweight daily best Hacker News stories, with screenshots and top comments. No JavaScript used. Deployed via GitHub Actions">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lopespm.github.io/2020/12/25/hackernews-daily.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="/atom.xml" rel="alternate" title="Byte Tank" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic&display=swap" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic&display=swap" rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Open+Sans&display=swap' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Fjalla+One&display=swap' rel='stylesheet' type='text/css'>
<link href="/stylesheets/rocket-loader/loader.min.css" rel="stylesheet" type="text/css">
  <meta property="og:title" content="Hacker News Daily - Byte Tank" />
<meta property="og:description" content="Lightweight daily best Hacker News stories, with screenshots and top comments. No JavaScript used. Deployed via GitHub Actions" />
<meta property="og:url" content="http://lopespm.github.io/2020/12/25/hackernews-daily.html" />
<meta property="og:image" content="http://lopespm.github.io/files/hackernews_daily/screenshots_cropped2.png" />
<meta property="og:site_name" content="Byte Tank" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />

<meta name="twitter:title" content="Hacker News Daily - Byte Tank">
<meta name="twitter:description" content="Lightweight daily best Hacker News stories, with screenshots and top comments. No JavaScript used. Deployed via GitHub Actions">

<meta name="twitter:creator" content="@lopes_pm">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://lopespm.github.io/files/hackernews_daily/screenshots_cropped2.png">


  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39962763-1', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <script src="https://www.youtube.com/iframe_api"></script>
<script>

  /* Based on: http://labnol.org/?p=27941 */

  // function onYouTubeIframeAPIReady() {
  //   initialize();
  // }

  document.addEventListener("DOMContentLoaded", initialize );

  function initialize() {
    console.log("Init");

    var div, n,
      v = document.getElementsByClassName("youtube-player");
    for (n = 0; n < v.length; n++) {
      div = document.createElement("div");
      div.setAttribute("data-id", v[n].dataset.id);
      div.innerHTML = labnolThumb(v[n].dataset.id, v[n].dataset.thumbsize);
      div.onclick = labnolIframe;

      v[n].classList.add("ytp-thumbnail-overlay");
      v[n].classList.add("ytp-cued-thumbnail-overlay");

      v[n].appendChild(div);
    }
  }

  function labnolThumb(id, thumbSize) {
    var thumb = getThumb(thumbSize);
    var thumbWithId = thumb.replace("ID", id);

    var youtubePlayButton = '<div class="play-youtube-button"><button class="ytp-large-play-button ytp-button"><svg height="100%" version="1.1" viewBox="0 0 68 48" width="100%"><path class="ytp-large-play-button-bg" d="m .66,37.62 c 0,0 .66,4.70 2.70,6.77 2.58,2.71 5.98,2.63 7.49,2.91 5.43,.52 23.10,.68 23.12,.68 .00,-1.3e-5 14.29,-0.02 23.81,-0.71 1.32,-0.15 4.22,-0.17 6.81,-2.89 2.03,-2.07 2.70,-6.77 2.70,-6.77 0,0 .67,-5.52 .67,-11.04 l 0,-5.17 c 0,-5.52 -0.67,-11.04 -0.67,-11.04 0,0 -0.66,-4.70 -2.70,-6.77 C 62.03,.86 59.13,.84 57.80,.69 48.28,0 34.00,0 34.00,0 33.97,0 19.69,0 10.18,.69 8.85,.84 5.95,.86 3.36,3.58 1.32,5.65 .66,10.35 .66,10.35 c 0,0 -0.55,4.50 -0.66,9.45 l 0,8.36 c .10,4.94 .66,9.45 .66,9.45 z" fill="#1f1f1e" fill-opacity="0.81"></path><path d="m 26.96,13.67 18.37,9.62 -18.37,9.55 -0.00,-19.17 z" fill="#fff"></path><path d="M 45.02,23.46 45.32,23.28 26.96,13.67 43.32,24.34 45.02,23.46 z" fill="#ccc"></path></svg></button></div>';



    var bg = '<div class="bg" style=\'background-image: url(\"' + thumbWithId + '\')\"></div>';
    var fadeBg = '<div class="fadeBg"></div>';
    return bg + fadeBg + youtubePlayButton;
  }

  function getThumb(thumbSize) {
    if (thumbSize === "0")
      return 'https://i.ytimg.com/vi/ID/hqdefault.jpg';
    if (thumbSize === "1")
      return 'https://i.ytimg.com/vi/ID/sddefault.jpg';
    else if (thumbSize === "2")
      return 'https://i.ytimg.com/vi/ID/maxresdefault.jpg';
    return 'https://i.ytimg.com/vi/ID/sddefault.jpg';
  }

  function labnolIframe() {
    var container = document.createElement("div");

    var loaderContainerOuter = document.createElement("div");
    loaderContainerOuter.setAttribute("style", "display: table; position: absolute; top: 0; left: 0; height: 100%; width: 100%; background-color: black; z-index: 200;");
    var loaderContainerMiddle = document.createElement("div");
    loaderContainerMiddle.setAttribute("style", "  display: table-cell; vertical-align: middle;");
    var loaderContainerInner = document.createElement("div");
    loaderContainerInner.setAttribute("style", "margin-left: auto; margin-right: auto; width: 400px;");

    loaderContainerOuter.appendChild(loaderContainerMiddle);
    loaderContainerMiddle.appendChild(loaderContainerInner);

    const loader = Rocket.loader({
      target: loaderContainerInner,
      size: 'large',
      type: 'spinner',
      colour: 'grey-blue-dark'
      //body: "Loading Video"
    });

    var containerPlayer = document.createElement("div");
    container.appendChild(containerPlayer);
    container.appendChild(loaderContainerOuter);

    this.parentNode.replaceChild(container, this);

    var didLoadAndPlay = 0;
    player = new YT.Player(containerPlayer, {
      videoId: this.dataset.id,
      playerVars: { 'autoplay': 1 },
      events: {
        'onReady': function(event) {
          event.target.playVideo();

          // Fallback if onStateChange is not called
          setInterval(function () {
            if (didLoadAndPlay === 0) {
              console.log("Hide on after ready");
              container.removeChild(loaderContainerOuter);
              didLoadAndPlay = 1;
            }
          }, 5000);
        },
        'onStateChange': function (event) {
          console.log(event.data);
          if (didLoadAndPlay === 0) {
            console.log("Hide on play");
            container.removeChild(loaderContainerOuter);
            didLoadAndPlay = 1;
          }
        }
      }
    });

  }

</script>


<script src="/javascripts/rocket-loader/tools.min.js"></script>
<script src="/javascripts/rocket-loader/loader.min.js"></script>
  <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
  <header role="banner"><hgroup>
  <h1><a href="/">Byte Tank</a></h1>
  
    <h2>Pedro Lopes Blog</h2>
  
</hgroup>


</header>
  <nav role="navigation">

<ul class="subscription">
  <li><a href="https://twitter.com/lopes_pm"><img src="/images/cn_twitter_19.png" height="19px" width="19px" /></a></li>
  <li><a href="https://github.com/lopespm"><img src="/images/cn_github_19.png" height="19px" width="19px"/></a></li>
  <li><a href="/atom.xml"><img src="/images/cn_rss_19.png" height="19px" width="19px"/></a></li>  
</ul>

  

<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/notes">Notes</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="article-full">
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Hacker News Daily</h1>
    
    
      <p class="meta">
        








  


<time datetime="2020-12-25T00:00:00+00:00" pubdate data-updated="true">Dec 25<span>th</span>, 2020</time>
        <!--
        
        -->
        
      </p>
    
  </header>


<div class="entry-content"><p>This article will dive into the system behind the generation of <a href="https://lopespm.github.io/hackernews_daily">Hacker News Daily</a>, an <a href="https://github.com/lopespm/hackernews_daily">open source</a> lightweight daily Hacker News best stories website, with screenshots and top comments.</p>

<center>
          <picture>
             <source type="image/webp" srcset="/files/hackernews_daily/screenshots_cropped2_705.webp" />
             <source type="image/png" srcset="/files/hackernews_daily/screenshots_cropped2_705.png" />
             <img src="/files/hackernews_daily/screenshots_cropped2_705.png" />
           </picture>
         </center>

<!--more-->

<p><br /></p>

<h1 id="motivation">Motivation</h1>

<p>Hacker News is my go-to source for relevant, interesting and constructive discussions on a wide range of topics. I usually consume it via <a href="https://www.daemonology.net/hn-daily/">Daemonology’s Hacker News Daily</a>, to catch up on the most active topics in the community.</p>

<p><a href="https://www.daemonology.net/hn-daily/">Daemonology’s Hacker News Daily</a> presents the title, story link, Hacker News discussion link, and is optimized for desktop. I usually consult it on mobile, and when I am several days behind, I sweep through the archives and open several story/discussion links in separate mobile tabs, in order to triage the stories with a quick glance at their web page and their discussion’s top comments.</p>

<p>This project aims to ease that process, by generating a set of web pages presenting the best daily Hacker News for mobile or desktop, with screenshots and top comments for each story, while aiming to have a low footprint to the end user.</p>

<h1 id="architecture">Architecture</h1>

<figure class="image"><center><a href="/files/hackernews_daily/hn_daily_diagram.png"><img src="/files/hackernews_daily/hn_daily_diagram.png" /></a></center><figcaption class="media-caption"> Information flow diagram between the different components of the system </figcaption></figure>

<p>The basilar idea is to recurrently get the <a href="https://news.ycombinator.com/best">best Hacker News</a> stories via its <a href="https://github.com/HackerNews/API">API</a>; take screenshots of the web pages that these stories link to; and have this workflow executed via <a href="https://github.com/features/actions">GitHub Actions</a>.</p>

<p>In specific, these are the steps taken to generate the final web pages (illustrated by the above diagram):</p>

<p><strong>1.</strong> Every day, a new <a href="https://github.com/lopespm/hackernews_daily/actions">Github Workflow</a> is spawned, kickstarting the entire process.</p>

<p><strong>2.</strong> Update History</p>

<ul>
  <li>The first step is to get the past days best stories from the last successful run, and add the current best stories by
 reaching out to the Hacker News API to fetch the current list of best stories, removing the ones that were already featured, and adding the top ones to the current history
    <ul>
      <li>To persist the past best stories history, an <code>days_history.dat</code> artifact is created in every run, which is a simple <a href="https://docs.python.org/3/library/pickle.html">Python Pickle</a> containing the story ids from the past days. These days are stored in form of a deque, in order to pop the older days as the history grows larger</li>
      <li>The final result of this step is a new <code>days_history.dat</code>, which will be used in the next step below, and will also serve as a base for the next workflow</li>
      <li>If a viable <code>days_history.dat</code> artifact cannot not be found in the previous successful runs, it is rebuilt by parsing the <a href="https://www.daemonology.net/hn-daily/">Daemonology’s Hacker News Daily</a> web page</li>
    </ul>
  </li>
</ul>

<p><strong>3.</strong> Create Day/Story Models</p>

<ul>
  <li>From the story ids provided by the previously built <code>days_history.dat</code>, a list of hydrated days with their respective stories are built. These models will posteriorly provide all the information needed to create the final web page views
    <ul>
      <li>Each story is composed of an ID, title, story link, Hacker News discussion link, and its top comments. This information is obtained via the Hacker News API (example <a href="https://hacker-news.firebaseio.com/v0/item/25518730.json?print=pretty">call</a>)</li>
    </ul>
  </li>
</ul>

<p><strong>4.</strong> Create the <code>generated</code> folder. This is where the generated web pages and screenshots will be placed, in order to be later deployed to GitHub pages</p>

<p><strong>5.</strong> Gather Screenshots</p>

<ul>
  <li>Using <a href="https://pypi.org/project/pyppeteer/">pyppeteer</a>, an headless browser is created to navigate through all the story links
    <ul>
      <li>A screenshot is taken for each of these pages (after attempting to dismiss a possible “Allow Cookies” prompt), and stored as PNGs in the <code>generated</code> folder</li>
      <li>Each of these screenshots are re-encoded in <a href="https://en.wikipedia.org/wiki/WebP">WebP</a>, which allows for a smaller image footprint in browser’s that support it</li>
    </ul>
  </li>
  <li>If there is an unexpected error while processing the screenshots, it will not halt the overall workflow, since the final web pages can still function without screenshot images</li>
</ul>

<p><strong>6</strong>. Generate Web Pages</p>

<ul>
  <li><a href="https://jinja.palletsprojects.com/en/2.11.x/">Jinja</a>, a templating engine for Python, is used to define and generate each of the final web pages. Four web pages are generated from a <a href="https://github.com/lopespm/hackernews_daily/blob/main/templates/page.html">single template</a>. These four variants are permutations of either presenting all past 10 days or not, and either showing images or not:
    <ul>
      <li>Latest day, with images</li>
      <li>Latest day, without images</li>
      <li>Past 10 days, with images</li>
      <li>Past 10 days, without images</li>
    </ul>
  </li>
  <li>It was chosen to keep these in separate static web pages, in order to keep them simple, static, and without additional dynamic logic</li>
</ul>

<p><strong>7.</strong> The <code>generated</code> folder is deployed to the <code>gh-pages</code> branch, which is deployed as a GitHub page, making these generated contents <a href="https://lopespm.github.io/hackernews_daily">publicly accessible</a></p>

<h1 id="source-code">Source Code</h1>

<p>The full source code is accessible at <a href="https://github.com/lopespm/hackernews_daily">https://github.com/lopespm/hackernews_daily</a> and the generated website at <a href="https://lopespm.github.io/hackernews_daily">https://lopespm.github.io/hackernews_daily</a>, feel free to improve it or to leave some feedback.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Pedro Lopes</span></span>

      








  


<time datetime="2020-12-25T00:00:00+00:00" pubdate data-updated="true">Dec 25<span>th</span>, 2020</time>
      
      

<span class="categories">
  
    <a class='category' href='/tags/aggregators/'>aggregators</a>
  
</span>


    </p>
    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2020/08/03/implementation-autocomplete-system-design.html" title="Previous Post: Implementation: Autocomplete System Design for Large Scale">&laquo; Implementation: Autocomplete System Design for Large Scale</a>
      
      
        <a class="basic-alignment right" href="/2022/03/22/learnings-software-engineer-techlead.html" title="Next Post: Learnings as a Software Engineer Techlead">Learnings as a Software Engineer Techlead &raquo;</a>
      
    </p>
  </footer>
</article>

  <div id="giscus-comments">
    <script async src="https://giscus.app/client.js"
        data-repo="lopespm/lopespm.github.com"
        data-repo-id="MDEwOlJlcG9zaXRvcnk3MDExOTAxNg=="
        data-category="Comments"
        data-category-id="DIC_kwDOBC3uaM4CYFCk"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="0"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
    </script>
  </section>

<!--

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

-->
</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/notes/2023/12/19/nyc_todo.html">New York City</a>
      </li>
    
      <li class="post">
        <a href="/notes/2023/10/21/investment_relative_cost_benefit.html">Relative Cost / Benefit of an Investment</a>
      </li>
    
      <li class="post">
        <a href="/notes/2023/09/30/goal_clarity_in_delegation.html">Importance of Goal Clarity for Delegation</a>
      </li>
    
      <li class="post">
        <a href="/notes/2023/08/19/life_exits.html">Life has several exits</a>
      </li>
    
      <li class="post">
        <a href="/notes/2023/08/05/real_question_behind_what_you_want.html">The real question behind 'what do you want?'</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/lopespm">@lopespm</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'lopespm',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2023 - <a href="/about">Pedro Lopes</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>. Theme based on <a href="https://github.com/lucaslew/whitespace"> Whitespace</a>. Subscribe via <a href="/atom.xml">RSS Feed</a>
</p>

</footer>
  





<script src="/javascripts/anchor.min.js"></script>

<script>
    anchors.options = {
      placement: 'left'
    };
    anchors.add();
    anchors.remove('.entry-title');
    anchors.remove('#byte-tank');
</script>



</body>
</html>
